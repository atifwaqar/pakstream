<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Stream‑from‑URL Player</title>
  <link rel="preconnect" href="https://cdn.plyr.io" />
  <link rel="stylesheet" href="https://cdn.plyr.io/3.7.8/plyr.css" />
  <style>
    :root{
      --bg:#0b0f14; --panel:#121821; --text:#e6edf3; --muted:#8091a7; --accent:#6ee7ff;
      --radius:20px;
    }
    *{box-sizing:border-box}
    body{margin:0; font-family: ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial; background:var(--bg); color:var(--text);}    
    .container{max-width:1100px; margin:24px auto; padding:0 16px;}
    .card{background:linear-gradient(180deg,rgba(255,255,255,0.04),rgba(255,255,255,0.02)); border:1px solid rgba(255,255,255,0.08); border-radius:var(--radius); box-shadow:0 10px 30px rgba(0,0,0,.35)}
    header{display:flex; justify-content:space-between; align-items:center; padding:20px 22px}
    header h1{margin:0; font-size:20px; letter-spacing:.5px}
    header .badge{font-size:12px; color:var(--bg); background:var(--accent); padding:6px 10px; border-radius:999px}
    .controls{display:grid; grid-template-columns:1.2fr .8fr .8fr auto; gap:12px; padding:16px 22px 22px; border-top:1px solid rgba(255,255,255,0.06)}
    .controls label{font-size:12px; color:var(--muted); display:block; margin-bottom:6px}
    .controls input{width:100%; padding:12px 12px; background:#0e141c; color:var(--text); border:1px solid rgba(255,255,255,0.08); border-radius:12px; outline:none}
    .controls input::placeholder{color:#5a6a80}
    .controls .btn{align-self:end; padding:12px 18px; border-radius:12px; background:var(--accent); color:#00222b; font-weight:700; border:none; cursor:pointer}
    .controls .btn:active{transform:translateY(1px)}

    .player-wrap{padding:18px;}
    .notice{padding:12px 16px; margin:0 22px 18px; border-radius:12px; background:#0e141c; color:#b9c6d2; font-size:13px; border:1px solid rgba(255,255,255,0.08)}

    /* Netflix-y poster glow */
    .plyr--video{border-radius:16px; overflow:hidden; box-shadow:0 12px 40px rgba(0,0,0,.5)}

    /* Loading shimmer */
    .skeleton{position:relative; overflow:hidden; background:#0e141c}
    .skeleton::after{content:""; position:absolute; inset:0; background:linear-gradient(90deg,transparent,rgba(255,255,255,.06),transparent); transform:translateX(-100%); animation:shimmer 1.75s infinite}
    @keyframes shimmer{100%{transform:translateX(100%)}}

    @media (max-width:900px){
      .controls{grid-template-columns:1fr;}
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="card">
      <header>
        <h1>Drop a direct media URL and play</h1>
        <span class="badge">MP4 • WebM • HLS (m3u8) • Subtitles</span>
      </header>

      <div class="player-wrap">
        <video id="player" playsinline controls crossorigin="anonymous"></video>
      </div>

      <p class="notice" id="tip">Paste a direct media URL (e.g. https://example.com/video.mp4 or https://…/index.m3u8). Optional: add a poster and a WebVTT subtitle.</p>

      <div class="controls">
        <div>
          <label for="url">Media URL</label>
          <input id="url" type="url" placeholder="https://host/path/video.mp4 or https://host/stream/index.m3u8" />
        </div>
        <div>
          <label for="poster">Poster (optional)</label>
          <input id="poster" type="url" placeholder="https://host/path/poster.jpg" />
        </div>
        <div>
          <label for="subs">Subtitles .vtt (optional)</label>
          <input id="subs" type="url" placeholder="https://host/path/subs.vtt" />
        </div>
        <button class="btn" id="loadBtn" type="button">Load & Play</button>
      </div>
    </div>
  </div>

  <!-- Plyr & HLS.js -->
  <script src="https://cdn.plyr.io/3.7.8/plyr.polyfilled.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/hls.js@1.5.7/dist/hls.min.js"></script>
  <script>
    // --- Utilities ---
    const $ = sel => document.querySelector(sel);
    const urlInput = $('#url');
    const posterInput = $('#poster');
    const subsInput = $('#subs');
    const tip = $('#tip');

    // Restore last session
    try{
      urlInput.value = localStorage.getItem('last_url') || '';
      posterInput.value = localStorage.getItem('last_poster') || '';
      subsInput.value = localStorage.getItem('last_subs') || '';
    }catch(e){}

    // Init Plyr
    const video = document.getElementById('player');
    const plyr = new Plyr(video, {
      ratio: '16:9',
      controls: [
        'play-large', 'play', 'progress', 'current-time', 'duration',
        'mute', 'volume', 'captions', 'settings', 'pip', 'airplay', 'fullscreen'
      ],
      settings: ['captions', 'quality', 'speed', 'loop'],
      clickToPlay: true,
      keyboard: { focused: true, global: true },
      autoplay: false
    });

    // Display an error message and reset loading state
    const showError = (msg) => {
      tip.textContent = msg;
      tip.style.color = '#ffb4b4';
      video.classList.remove('skeleton');
    };

    // Load media based on URL (supports MP4/WebM/HLS)
    async function loadAndPlay(){
      const src = urlInput.value.trim();
      const poster = posterInput.value.trim();
      const subs = subsInput.value.trim();
      if(!src){
        tip.textContent = 'Please paste a direct media URL first.';
        tip.style.color = '#ffb4b4';
        return;
      }

      // Persist inputs
      try{
        localStorage.setItem('last_url', src);
        localStorage.setItem('last_poster', poster);
        localStorage.setItem('last_subs', subs);
      }catch(e){}

      // Reset
      tip.textContent = 'Loading…';
      tip.style.color = '#b9c6d2';
      video.classList.add('skeleton');
      plyr.stop();

      // Clear old tracks
      [...video.querySelectorAll('track')].forEach(t => t.remove());

      // Poster
      video.poster = poster || '';

      // Subtitles if provided
      if(subs){
        const track = document.createElement('track');
        track.kind = 'subtitles';
        track.label = 'Subtitles';
        track.srclang = 'en';
        track.default = true;
        track.src = subs;
        video.appendChild(track);
      }

      // HLS detection
      const isHls = /\.m3u8($|\?)/i.test(src);

      try{
        if(isHls && window.Hls && Hls.isSupported()){
          // Use hls.js for widest support
          if(window._hls){ window._hls.destroy(); }
          const hls = new Hls({
            xhrSetup: (xhr)=>{xhr.withCredentials = false;}
          });
          window._hls = hls;
          hls.loadSource(src);
          hls.attachMedia(video);
          hls.on(Hls.Events.MANIFEST_PARSED, ()=>{
            // Map HLS levels to Plyr quality menu
            const levels = hls.levels.map(l => l.height).filter(Boolean).sort((a,b)=>a-b);
            plyr.options.quality = {
              default: levels[levels.length-1] || 0,
              options: [...new Set(levels)],
              forced: true,
              onChange: (q)=>{
                const levelIndex = hls.levels.findIndex(l=>l.height===q);
                hls.currentLevel = levelIndex;
              }
            };
            video.classList.remove('skeleton');
            plyr.play();
            tip.textContent = 'Playing via HLS';
          });
          hls.on(Hls.Events.ERROR, (evt, data)=>{
            showError('HLS error: ' + data.type);
          });
        } else if(isHls && video.canPlayType('application/vnd.apple.mpegurl')){
          // Safari can play HLS natively
          video.src = src;
          video.addEventListener('loadedmetadata', ()=>{ video.classList.remove('skeleton'); plyr.play(); tip.textContent='Playing HLS (native)'; }, {once:true});
          video.addEventListener('error', ()=>{ showError('Could not load media. This server may block cross‑origin (CORS) playback.'); }, {once:true});
          video.load();
        } else {
          // Assume direct MP4/WebM, etc.
          video.src = src;
          video.addEventListener('loadedmetadata', ()=>{ video.classList.remove('skeleton'); plyr.play(); tip.textContent='Playing file'; }, {once:true});
          video.addEventListener('error', ()=>{ showError('Could not load media. This server may block cross‑origin (CORS) playback.'); }, {once:true});
          video.load();
        }
      }catch(err){
        console.error(err);
        showError('Could not load media. This server may block cross‑origin (CORS) playback.');
      }
    }

    document.getElementById('loadBtn').addEventListener('click', loadAndPlay);

    // Enter to load
    urlInput.addEventListener('keydown', e=>{ if(e.key==='Enter'){ loadAndPlay(); }});

    // Media Session API for nicer OS controls
    if('mediaSession' in navigator){
      navigator.mediaSession.metadata = new MediaMetadata({
        title: 'Stream‑from‑URL',
        artist: 'Plyr',
        album: 'Web',
      });
    }
  </script>
</body>
</html>
